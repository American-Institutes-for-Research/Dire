<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Marginal Maximum Likelihood Estimation of Linear Models — mml • Dire</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Marginal Maximum Likelihood Estimation of Linear Models — mml" />
<meta property="og:description" content="Implements a survey-weighted marginal maximum estimation, a type of
regression where the outcome is a latent trait (such as student ability).
Instead of using an estimate, the likelihood function marginalizes student
ability. Includes a variety of variance estimation strategies." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Dire</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/MML.html">Marginal Maximum Likelihood Regression Estimation</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/American-Institutes-for-Research/Dire/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Marginal Maximum Likelihood Estimation of Linear Models</h1>
    <small class="dont-index">Source: <a href='https://github.com/American-Institutes-for-Research/Dire/blob/master/R/de.R'><code>R/de.R</code></a></small>
    <div class="hidden name"><code>mml.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Implements a survey-weighted marginal maximum estimation, a type of
regression where the outcome is a latent trait (such as student ability).
Instead of using an estimate, the likelihood function marginalizes student
ability. Includes a variety of variance estimation strategies.</p>
    </div>

    <pre class="usage"><span class='fu'>mml</span><span class='op'>(</span>
  <span class='va'>formula</span>,
  <span class='va'>stuItems</span>,
  <span class='va'>stuDat</span>,
  <span class='va'>idVar</span>,
  dichotParamTab <span class='op'>=</span> <span class='cn'>NULL</span>,
  polyParamTab <span class='op'>=</span> <span class='cn'>NULL</span>,
  testScale <span class='op'>=</span> <span class='cn'>NULL</span>,
  Q <span class='op'>=</span> <span class='fl'>30</span>,
  minNode <span class='op'>=</span> <span class='op'>-</span><span class='fl'>4</span>,
  maxNode <span class='op'>=</span> <span class='fl'>4</span>,
  polyModel <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"GPCM"</span>, <span class='st'>"GRM"</span><span class='op'>)</span>,
  weightVar <span class='op'>=</span> <span class='cn'>NULL</span>,
  multiCore <span class='op'>=</span> <span class='cn'>FALSE</span>,
  bobyqaControl <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>maxfun <span class='op'>=</span> <span class='fl'>1e+05</span><span class='op'>)</span>,
  composite <span class='op'>=</span> <span class='cn'>TRUE</span>,
  strataVar <span class='op'>=</span> <span class='cn'>NULL</span>,
  PSUVar <span class='op'>=</span> <span class='cn'>NULL</span>,
  fast <span class='op'>=</span> <span class='cn'>TRUE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>formula</th>
      <td><p>a <code><a href='https://rdrr.io/r/stats/formula.html'>formula</a></code>
object in the style of <code><a href='https://rdrr.io/r/stats/lm.html'>lm</a></code></p></td>
    </tr>
    <tr>
      <th>stuItems</th>
      <td><p>a list where each element is named a student ID and contains
a <code>data.frame</code>; see Details for the format</p></td>
    </tr>
    <tr>
      <th>stuDat</th>
      <td><p>a <code>data.frame</code> with a single row per student. Predictors in
the <code>formula</code> must be in <code>stuDat</code>.</p></td>
    </tr>
    <tr>
      <th>idVar</th>
      <td><p>a variable name on <code>stuDat</code> that is the identifier. Every 
ID from <code>stuDat</code> must appear on <code>stuItems</code> and vice versa.</p></td>
    </tr>
    <tr>
      <th>dichotParamTab</th>
      <td><p>a <code>data.frame</code> of dichotimous item information, see Details</p></td>
    </tr>
    <tr>
      <th>polyParamTab</th>
      <td><p>a <code>data.frame</code> of polytimous item information, see Details</p></td>
    </tr>
    <tr>
      <th>testScale</th>
      <td><p>a <code>data.frame</code> of scaling information, see Details</p></td>
    </tr>
    <tr>
      <th>Q</th>
      <td><p>an integer; the number of integration points</p></td>
    </tr>
    <tr>
      <th>minNode</th>
      <td><p>a numeric; the smallest integration point for the latent variable</p></td>
    </tr>
    <tr>
      <th>maxNode</th>
      <td><p>a numeric; the largest integration point for the latent variable</p></td>
    </tr>
    <tr>
      <th>polyModel</th>
      <td><p>polytomous response model;
one of <code>GPCM</code> for the Graded Partial Credit Model
or <code>GRM</code> for the Graded Response Model</p></td>
    </tr>
    <tr>
      <th>weightVar</th>
      <td><p>a variable name on <code>stuDat</code> that is the full sample weight</p></td>
    </tr>
    <tr>
      <th>multiCore</th>
      <td><p>allows the <code>foreach</code> package to be used. You should
                 have already setup the 
<code>registerDoParallel</code>.</p></td>
    </tr>
    <tr>
      <th>bobyqaControl</th>
      <td><p>a list that gets passed to <code><a href='https://rdrr.io/pkg/minqa/man/bobyqa.html'>bobyqa</a></code></p></td>
    </tr>
    <tr>
      <th>composite</th>
      <td><p>a logical indicating if an overall test should be treated as
a composite score; a composite is a weighted average of the
subscales in it.</p></td>
    </tr>
    <tr>
      <th>strataVar</th>
      <td><p>character naming a variable on <code>stuDat</code>, the variable indicating the
stratum for each row. Used in post-hoc robust variance estimation.</p></td>
    </tr>
    <tr>
      <th>PSUVar</th>
      <td><p>character naming a variable on <code>stuDat</code>; the primary sampling unit
(PSU) variable. Used in post-hoc robust variance estimation. The values
do not need to be unique across strata.</p></td>
    </tr>
    <tr>
      <th>fast</th>
      <td><p>a logical indicating if cpp code should be used in <code>mml</code> processes. This should 
yield speed-ups to runs.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>when called for a single subscale or overall score, returns object of class <code>mmlMeans</code>. 
This is a list with elements:</p><ul>
<li><p><code>call</code> the call used to generate this <code>mml.means</code> object</p></li>
<li><p><code>coefficients</code> the unscaled marginal maximum likelihood regression coefficients</p></li>
<li><p><code>LogLik</code> the log-likelihood of the fit model</p></li>
<li><p><code>X</code> the design matrix of the marginal maximum likelihood regression</p></li>
<li><p><code>Convergence</code> a convergence note from the <code>bobyqa</code> optimizer</p></li>
<li><p><code>location</code> used for scaling the estimates</p></li>
<li><p><code>scale</code> used for scaling the estimates</p></li>
<li><p><code>lnlf</code> the log-likelihood function of the unscaled parameters</p></li>
<li><p><code>rr1</code> the density function of each individual, conditional only on item responses in <code>stuItems</code></p></li>
<li><p><code>stuDat</code> the <code>stuDat</code> argument</p></li>
<li><p><code>weightVar</code> the name of the weight variable on <code>stuDat</code></p></li>
<li><p><code>nodes</code> the nodes the likelihood was evaluated on</p></li>
<li><p><code>iterations</code> the number of iterations required to reach convergence</p></li>
<li><p><code>obs</code> the number of observations used</p></li>
<li><p><code>weightedObs</code> the weighted N for the observations</p></li>
<li><p><code>strataVar</code> the column name of the stratum variable on stuDat; potentially used for variance estimation</p></li>
<li><p><code>PSUVar</code> the column name of the stratum variable on stuDat; potentially used for variance estimation</p></li>
</ul>

<p>When a composite score is computed there are several subscales run and the return is a <code>mmlCompositeMeans</code>. Many elements are themselves list with one element per construct.
this is a list with elements:</p><ul>
<li><p><code>call</code> the call used to generate this <code>mml.means</code> object</p></li>
<li><p><code>coefficients</code> matrix of the unscaled marginal maximum likelihood regression coefficients, each row represents a subscale, each column represents a coefficient</p></li>
<li><p><code>X</code> the design matrix of the marginal maximum likelihood regression</p></li>
<li><p><code>rr1</code> a list of elements, each the rr1 object for a subscale (see <code>mmlMeans</code> output)</p></li>
<li><p><code>ids</code> The ID variable used for each row of <code>stuDat</code></p></li>
<li><p><code>Convergence</code> a vector of convergence notes from the <code>bobyqa</code> optimizer</p></li>
<li><p><code>lnlfl</code> a list of log-likelihood functions of the unscaled parameters, by construct</p></li>
<li><p><code>stuDat</code> a list of <code>stuDat</code> data frames, as used when fitting each construct, filtered to just relevant student records</p></li>
<li><p><code>weightVar</code> the name of the weight variable on <code>stuDat</code></p></li>
<li><p><code>nodes</code> the nodes the likelihood was evaluated on</p></li>
<li><p><code>iterations</code> a vector of the number of iterations required to reach convergence on each construct</p></li>
<li><p><code>obs</code> a vector of the the number of observations used on each construct</p></li>
<li><p><code>testScale</code> the <code>testScale</code> used to scale the data</p></li>
<li><p><code>weightedObs</code> a vector of the weighted N for the observations</p></li>
<li><p><code>SubscaleVC</code> the covariance matrix of subscales. The residuals are assumed to be multivariate normal with this covairiance matrix</p></li>
<li><p><code>idVar</code> the name of the identifier used on <code>stuDat</code> and <code>stuItems</code> data</p></li>
<li><p><code>resl</code> list of mmlMeans objects, one per construct</p></li>
<li><p><code>strataVar</code> the column name of the stratum variable on <code>stuDat</code>; potentially used for variance estimation</p></li>
<li><p><code>PSUVar</code> the column name of the stratum variable on <code>stuDat</code>; potentially used for variance estimation</p></li>
</ul>

<p><code>LogLik</code> is not returned because there is no likelihood for a composite model.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The <code>mml</code> function models a latent outcome conditioning on
item response data, covariate data, item parameter information,
and scaling information.
These four parts are broken up into at least one argument each.
Student item response data go into <code>stuItems</code>; whereas student
covariates, weights, and sampling information go into <code>stuDat</code>.
The <code>dichotParamTab</code> and <code>polyParamTab</code>
contains item parameter information for dichotimous and polytimous items,
respectively---the item parameter data is the result of an existing
item parameter scaling. In the case of 
the National Assessment of Educational Progress (NAEP),
they can be found online, for example, at
<a href='https://nces.ed.gov/nationsreportcard/tdw/analysis/scaling_irt.aspx'>https://nces.ed.gov/nationsreportcard/tdw/analysis/scaling_irt.aspx</a>.
Finally, information about scaling and subscale weights for composites are put in <code>testScale</code>.</p>
<p>The model for dichotomous responses data is, by default, three Parameter Logit
(3PL), unless the item parameter information provided by users suggests
otherwise. For example, if the scaling used a two Parameter Logit (2PL) model,
then the guessing parameter can simply be set to zero. For polytomous
responses data, the model is dictated by the <code>polyModel</code> argument.</p>
<p>The <code>dichotParamTab</code> argument is a <code>data.frame</code> with a column named
<code>ItemID</code> that identifies the items and agrees with
the <code>key</code> column in the <code>stuItems</code> argument,
and, for  a 3PL item, columns <code>slope</code>,
<code>difficulty</code>, and <code>guessing</code> for the &#8220;a&#8221;, &#8220;d&#8221;, and
&#8220;g&#8221; parameters, respectively; see the vignette for details of
the 3PL model. Users can also use the column names directly from the
vignette notation (&#8220;a&#8221;, &#8220;d&#8221;, and &#8220;g&#8221;) if they prefer.
Items that are missing (<code>NA</code>) are not used in the likelihood function 
Users wishing to apply a special behavior for a subset of items can use
set those items to an invalid score and put that in the <code>dichotParamTab</code>
column <code>missingCode</code>. They are then scored as if they are <code>missingValue</code>
proportion correct. To use the guessing parameter for the proportion correct
set <code>missingValue</code> to &#8220;c&#8221;.</p>
<p>The <code>polyParamTab</code> has columns <code>ItemID</code> that must match with the
<code>key</code> from <code>stuItems</code>, as well as <code>slope</code>
(which can also be called <code>a</code>) that corresponds to the <code>a</code>
parameter in the vignette.
Users must also specify the location of the cut points (d-sub-cj in the vignette)
which are named <code>d1</code>, <code>d2</code>, ..., up to <code>dn</code> where <code>n</code> is
one less than the number of score points. Some people prefer to also apply a 
shift to all of these and this shift is applied when there is a column named
<code>itemLocation</code> by simply adding that to every <code>d*</code> column. Items
are not included in the likelihood for an individual when there value on <code>stuItems</code>
is <code>NA</code>, but no provision is made for guessing, nor special provision for 
missing codes in polytimious items.</p>
<p>For both <code>dichotParamTab</code> and <code>polyParamTab</code> users wishing
to use a <code>D</code> paramter of 1.7 (or any other value) may specify that, per item,
in a column named <code>D</code>.</p>
<p>When there are multiple constructs, subscales, or the user wants a composite
score, additional, optional, columns <code>test</code> and <code>subtest</code> can be used. 
these columns can be numeric or text, they must agree with the same 
columns in <code>testScale</code> to scale the results.</p>
<p>Student data are broken up into two parts. The item response data goes
into <code>stuItems</code>, and the student covariates for the formula go into
<code>stuDat</code>. Information about items, such as item difficulties, is in 
<code>paramTab</code>. All dichotomous items are assumed to be 
3PL, though by setting the guessing parameter to zero, the user
can use a 2PL or the one Parameter Logit (1PL) or Rasch models.
The model for polytomous responses data is dictated by the <code>polyModel</code>
argument.</p>
<p>The marginal maximum likelihood then integrates the product of the student
ability from the assessment data, and the estimate from the linear model
estimates each student's ability based on the <code>formula</code> provided
and a residual standard error term. This integration happens from the
minimum node to the maximum node in the <code>control</code> argument (described
later in this section) with <code>Q</code> quadrature points.</p>
<p>The <code>stuItems</code> argument has the scored student data. It is a list where
each element is named with student ID and contains
a <code>data.frame</code> with at least two columns.
The first required column is named
<code>key</code> and shows the item name as it appears in <code>paramTab</code>;
the second column in named
<code>score</code> and shows the score for that item. For binomial
items, the <code>score</code> is 0 or 1. For <code>GPCM</code> items, the scores
start at zero as well. For <code>GRM</code>, the scores start at 1.</p>
<p>For a <code>GPCM</code> model, <code>P0</code> is the &#8220;a&#8221; parameter, and the other 
columns are the &#8220;d&#8221; parameters; see the vignette for details
of the GPCM model.</p>
<p>The quadrature points then are a range from <code>minNode</code> to <code>maxNode</code>
with a total of <code>Q</code> nodes.</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Harold Doran, Paul Bailey, Claire Kelley, Sun-joo Lee, and Eric Buehler</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='va'><a href='https://www.air.org/project/nces-data-r-project-edsurvey'>EdSurvey</a></span><span class='op'>)</span>

<span class='co'># 1) make param tab for dichotomous items</span>
<span class='va'>dichotParamTab</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>ItemID <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"m109801"</span>, <span class='st'>"m020001"</span>, <span class='st'>"m111001"</span>,
                                        <span class='st'>"m046301"</span>, <span class='st'>"m046501"</span>, <span class='st'>"m051501"</span>,
                                        <span class='st'>"m111601"</span>, <span class='st'>"m111301"</span>, <span class='st'>"m111201"</span>,
                                        <span class='st'>"m110801"</span>, <span class='st'>"m110101"</span><span class='op'>)</span>,
                             test <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>"composite"</span>,<span class='fl'>11</span><span class='op'>)</span>,
                             subtest <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>"num"</span>,<span class='fl'>6</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>"alg"</span>,<span class='fl'>5</span><span class='op'>)</span><span class='op'>)</span>,
                             slope <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.96</span>, <span class='fl'>0.69</span>, <span class='fl'>0.83</span>,
                                       <span class='fl'>0.99</span>, <span class='fl'>1.03</span>, <span class='fl'>0.97</span>,
                                       <span class='fl'>1.45</span>, <span class='fl'>0.59</span>, <span class='fl'>0.34</span>,
                                       <span class='fl'>0.18</span>, <span class='fl'>1.20</span><span class='op'>)</span>,
                             difficulty <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>0.37</span>, <span class='op'>-</span><span class='fl'>0.55</span>,  <span class='fl'>0.85</span>,
                                            <span class='op'>-</span><span class='fl'>0.97</span>, <span class='op'>-</span><span class='fl'>0.14</span>,  <span class='fl'>1.21</span>,
                                             <span class='fl'>0.53</span>, <span class='op'>-</span><span class='fl'>1.84</span>, <span class='op'>-</span><span class='fl'>0.46</span>,
                                             <span class='fl'>2.43</span>,  <span class='fl'>0.70</span><span class='op'>)</span>,
                             guessing <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.16</span>, <span class='fl'>0.00</span>, <span class='fl'>0.17</span>,
                                          <span class='fl'>0.31</span>, <span class='fl'>0.37</span>, <span class='fl'>0.18</span>,
                                          <span class='fl'>0.28</span>, <span class='fl'>0.15</span>, <span class='fl'>0.09</span>,
                                          <span class='fl'>0.05</span>, <span class='fl'>0.18</span><span class='op'>)</span>,
                             D <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1.7</span>, <span class='fl'>11</span><span class='op'>)</span>,
                             MODEL <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>"3pl"</span>, <span class='fl'>11</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># param tab for GPCM items</span>
<span class='va'>polyParamTab</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>ItemID <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"m0757cl"</span>, <span class='st'>"m066501"</span><span class='op'>)</span><span class='op'>)</span>,
                           test <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>"composite"</span>,<span class='fl'>2</span><span class='op'>)</span>,
                           subtest <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>"alg"</span>,<span class='fl'>2</span><span class='op'>)</span>,
                           slope <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.43</span>, <span class='fl'>0.52</span><span class='op'>)</span>, <span class='co'># could also be called "a"</span>
                           itemLocation <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>1.21</span>, <span class='op'>-</span><span class='fl'>0.96</span><span class='op'>)</span>, <span class='co'># added to d1 ... dn</span>
                           d1 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2.38</span>, <span class='op'>-</span><span class='fl'>0.56</span><span class='op'>)</span>, 
                           d2 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>0.57</span>, <span class='fl'>0.56</span><span class='op'>)</span>,
                           d3 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>1.18</span>, <span class='cn'>NA</span><span class='op'>)</span>,
                           D <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1.7</span>, <span class='fl'>1.7</span><span class='op'>)</span>,
                           scorePoints <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>4L</span>, <span class='fl'>3L</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># number of score points, read d1 to d(n-1)</span>
<span class='co'># read-in NAEP Primer data </span>
<span class='va'>sdf</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/EdSurvey/man/readNAEP.html'>readNAEP</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"extdata/data"</span>, <span class='st'>"M36NT2PM.dat"</span>, package <span class='op'>=</span> <span class='st'>"NAEPprimer"</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'># read in these items</span>
<span class='va'>items</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>dichotParamTab</span><span class='op'>$</span><span class='va'>ItemID</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>polyParamTab</span><span class='op'>$</span><span class='va'>ItemID</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'># dsex, student sex</span>
<span class='co'># origwt, full sample weights</span>
<span class='co'># repgrp1, stratum indicator</span>
<span class='co'># jkunit, PSU indicator</span>
<span class='va'>edf</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/EdSurvey/man/getData.html'>getData</a></span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>sdf</span>, varnames<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>items</span>, <span class='st'>"dsex"</span>, <span class='st'>"origwt"</span>, <span class='st'>"repgrp1"</span>, <span class='st'>"jkunit"</span>, <span class='st'>"sdracem"</span><span class='op'>)</span>,
               omittedLevels <span class='op'>=</span> <span class='cn'>FALSE</span>, returnJKreplicates<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span>
<span class='co'># make up a student ID</span>
<span class='va'>edf</span><span class='op'>$</span><span class='va'>sid</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"S"</span>,<span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>edf</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'># apply simplified scoring</span>
<span class='kw'>for</span><span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>items</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>coli</span> <span class='op'>&lt;-</span> <span class='va'>items</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span>
  <span class='co'># save the original</span>
  <span class='va'>rawcol</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>coli</span>,<span class='st'>"raw"</span><span class='op'>)</span>
  <span class='va'>edf</span><span class='op'>[</span>,<span class='va'>rawcol</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>edf</span><span class='op'>[</span>,<span class='va'>coli</span><span class='op'>]</span>
  <span class='kw'>if</span><span class='op'>(</span> <span class='va'>coli</span> <span class='op'>%in%</span> <span class='va'>dichotParamTab</span><span class='op'>$</span><span class='va'>ItemID</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='va'>edf</span><span class='op'>[</span>,<span class='va'>coli</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grepl</a></span><span class='op'>(</span><span class='st'>"[ABCDE]"</span>, <span class='va'>edf</span><span class='op'>[</span>,<span class='va'>rawcol</span><span class='op'>]</span><span class='op'>)</span>, <span class='fl'>0</span>, <span class='cn'>NA</span><span class='op'>)</span>
    <span class='va'>edf</span><span class='op'>[</span>,<span class='va'>coli</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grepl</a></span><span class='op'>(</span><span class='st'>"*"</span>, <span class='va'>edf</span><span class='op'>[</span>,<span class='va'>rawcol</span><span class='op'>]</span><span class='op'>)</span>, <span class='fl'>1</span>, <span class='va'>edf</span><span class='op'>[</span>,<span class='va'>coli</span><span class='op'>]</span><span class='op'>)</span>
  <span class='op'>}</span> <span class='kw'>else</span> <span class='op'>{</span>
    <span class='co'># scale for m066501</span>
    <span class='va'>edf</span><span class='op'>[</span>,<span class='va'>coli</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grepl</a></span><span class='op'>(</span><span class='st'>"Incorrect"</span>, <span class='va'>edf</span><span class='op'>[</span>,<span class='va'>rawcol</span><span class='op'>]</span><span class='op'>)</span>, <span class='fl'>0</span>, <span class='cn'>NA</span><span class='op'>)</span>
    <span class='va'>edf</span><span class='op'>[</span>,<span class='va'>coli</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grepl</a></span><span class='op'>(</span><span class='st'>"Partial"</span>, <span class='va'>edf</span><span class='op'>[</span>,<span class='va'>rawcol</span><span class='op'>]</span><span class='op'>)</span>, <span class='fl'>1</span>, <span class='va'>edf</span><span class='op'>[</span>,<span class='va'>coli</span><span class='op'>]</span><span class='op'>)</span>
    <span class='va'>edf</span><span class='op'>[</span>,<span class='va'>coli</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grepl</a></span><span class='op'>(</span><span class='st'>"Correct"</span>, <span class='va'>edf</span><span class='op'>[</span>,<span class='va'>rawcol</span><span class='op'>]</span><span class='op'>)</span>, <span class='fl'>2</span>, <span class='va'>edf</span><span class='op'>[</span>,<span class='va'>coli</span><span class='op'>]</span><span class='op'>)</span>
    <span class='co'># scale for m0757cl</span>
    <span class='va'>edf</span><span class='op'>[</span>,<span class='va'>coli</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grepl</a></span><span class='op'>(</span><span class='st'>"None correct"</span>, <span class='va'>edf</span><span class='op'>[</span>,<span class='va'>rawcol</span><span class='op'>]</span><span class='op'>)</span>, <span class='fl'>0</span>, <span class='va'>edf</span><span class='op'>[</span>,<span class='va'>coli</span><span class='op'>]</span><span class='op'>)</span>
    <span class='va'>edf</span><span class='op'>[</span>,<span class='va'>coli</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grepl</a></span><span class='op'>(</span><span class='st'>"One correct"</span>, <span class='va'>edf</span><span class='op'>[</span>,<span class='va'>rawcol</span><span class='op'>]</span><span class='op'>)</span>, <span class='fl'>1</span>, <span class='va'>edf</span><span class='op'>[</span>,<span class='va'>coli</span><span class='op'>]</span><span class='op'>)</span>
    <span class='va'>edf</span><span class='op'>[</span>,<span class='va'>coli</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grepl</a></span><span class='op'>(</span><span class='st'>"Two correct"</span>, <span class='va'>edf</span><span class='op'>[</span>,<span class='va'>rawcol</span><span class='op'>]</span><span class='op'>)</span>, <span class='fl'>2</span>, <span class='va'>edf</span><span class='op'>[</span>,<span class='va'>coli</span><span class='op'>]</span><span class='op'>)</span>
    <span class='va'>edf</span><span class='op'>[</span>,<span class='va'>coli</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grepl</a></span><span class='op'>(</span><span class='st'>"Three correct"</span>, <span class='va'>edf</span><span class='op'>[</span>,<span class='va'>rawcol</span><span class='op'>]</span><span class='op'>)</span>, <span class='fl'>3</span>, <span class='va'>edf</span><span class='op'>[</span>,<span class='va'>coli</span><span class='op'>]</span><span class='op'>)</span>
  <span class='op'>}</span>
  <span class='va'>edf</span><span class='op'>[</span>,<span class='va'>rawcol</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='cn'>NULL</span> <span class='co'># delete original</span>
<span class='op'>}</span>

<span class='co'># stuItems has one row per student/item combination</span>
<span class='va'>stuItems</span> <span class='op'>&lt;-</span> <span class='va'>edf</span><span class='op'>[</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"sid"</span>, <span class='va'>items</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>stuItems</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/reshape.html'>reshape</a></span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>stuItems</span>, varying<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>items</span><span class='op'>)</span>, idvar<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"sid"</span><span class='op'>)</span>,
                    direction<span class='op'>=</span><span class='st'>"long"</span>, v.names<span class='op'>=</span><span class='st'>"score"</span>, times<span class='op'>=</span><span class='va'>items</span>, timevar<span class='op'>=</span><span class='st'>"key"</span><span class='op'>)</span>
<span class='co'># stuDat is one row per student an contains student-level information</span>
<span class='va'>stuDat</span> <span class='op'>&lt;-</span> <span class='va'>edf</span><span class='op'>[</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"sid"</span>, <span class='st'>"origwt"</span>, <span class='st'>"repgrp1"</span>, <span class='st'>"jkunit"</span>, <span class='st'>"dsex"</span>, <span class='st'>"sdracem"</span><span class='op'>)</span><span class='op'>]</span>

<span class='co'># testDat shows scaling and weights for subtests, an overall score can be treated as a subtest</span>
<span class='va'>testDat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>test<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"composite"</span>, <span class='st'>"composite"</span><span class='op'>)</span> ,
                      subtest<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"num"</span>, <span class='st'>"alg"</span><span class='op'>)</span>,
                      location<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>277.1563</span>, <span class='fl'>280.2948</span><span class='op'>)</span>,
                      scale<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>37.7297</span>, <span class='fl'>36.3887</span><span class='op'>)</span>,
                      subtestWeight<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.3</span>,<span class='fl'>0.7</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># estimate a regression for Algebra subscale</span>
<span class='va'>mmlA</span> <span class='op'>&lt;-</span> <span class='fu'>mml</span><span class='op'>(</span><span class='va'>alg</span> <span class='op'>~</span> <span class='va'>dsex</span>,
            stuItems<span class='op'>=</span><span class='va'>stuItems</span>, stuDat<span class='op'>=</span><span class='va'>stuDat</span>,
            dichotParamTab<span class='op'>=</span><span class='va'>dichotParamTab</span>, polyParamTab<span class='op'>=</span><span class='va'>polyParamTab</span>,
            testScale<span class='op'>=</span><span class='va'>testDat</span>,
            idVar<span class='op'>=</span><span class='st'>"sid"</span>, weightVar<span class='op'>=</span><span class='st'>"origwt"</span>, <span class='co'># these are column names on stuDat</span>
            strataVar<span class='op'>=</span><span class='st'>"repgrp1"</span>, PSUVar<span class='op'>=</span><span class='st'>"jkunit"</span><span class='op'>)</span>
<span class='co'># summary, with Taylor standard errors</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>mmlA</span>, varType<span class='op'>=</span><span class='st'>"Taylor"</span><span class='op'>)</span>

<span class='co'># composite regression </span>
<span class='va'>mmlC</span> <span class='op'>&lt;-</span> <span class='fu'>mml</span><span class='op'>(</span><span class='va'>composite</span> <span class='op'>~</span> <span class='va'>dsex</span> ,
            stuItems<span class='op'>=</span><span class='va'>stuItems</span>, stuDat<span class='op'>=</span><span class='va'>stuDat</span>,
            dichotParamTab<span class='op'>=</span><span class='va'>dichotParamTab</span>, polyParamTab<span class='op'>=</span><span class='va'>polyParamTab</span>,
            testScale<span class='op'>=</span><span class='va'>testDat</span>,
            idVar<span class='op'>=</span><span class='st'>"sid"</span>, weightVar<span class='op'>=</span><span class='st'>"origwt"</span>, <span class='co'># these are column names on stuDat</span>
            strataVar<span class='op'>=</span><span class='st'>"repgrp1"</span>, PSUVar<span class='op'>=</span><span class='st'>"jkunit"</span><span class='op'>)</span>
<span class='co'># summary, with Taylor standard errors</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>mmlC</span>, varType<span class='op'>=</span><span class='st'>"Taylor"</span><span class='op'>)</span>

<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Emmanuel Sikali, Harold Doran, Paul Bailey, Eric Buehler, Sun-joo Lee.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


