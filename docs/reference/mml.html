<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Marginal Maximum Likelihood Estimation of Linear Models — mml • Dire</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Marginal Maximum Likelihood Estimation of Linear Models — mml"><meta name="description" content="Implements a survey-weighted marginal maximum estimation, a type of
regression where the outcome is a latent trait (such as student ability).
Instead of using an estimate, the likelihood function marginalizes student
ability. Includes a variety of variance estimation strategies."><meta property="og:description" content="Implements a survey-weighted marginal maximum estimation, a type of
regression where the outcome is a latent trait (such as student ability).
Instead of using an estimate, the likelihood function marginalizes student
ability. Includes a variety of variance estimation strategies."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Dire</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/MML.html">Weighted Marginal Maximum Likelihood Regression Estimation</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/American-Institutes-for-Research/Dire/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Marginal Maximum Likelihood Estimation of Linear Models</h1>
      <small class="dont-index">Source: <a href="https://github.com/American-Institutes-for-Research/Dire/blob/HEAD/R/de.R" class="external-link"><code>R/de.R</code></a></small>
      <div class="d-none name"><code>mml.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Implements a survey-weighted marginal maximum estimation, a type of
regression where the outcome is a latent trait (such as student ability).
Instead of using an estimate, the likelihood function marginalizes student
ability. Includes a variety of variance estimation strategies.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">mml</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  stuItems <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">stuDat</span>,</span>
<span>  <span class="va">idVar</span>,</span>
<span>  dichotParamTab <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  polyParamTab <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  testScale <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  Q <span class="op">=</span> <span class="fl">66</span>,</span>
<span>  minNode <span class="op">=</span> <span class="op">-</span><span class="fl">5</span>,</span>
<span>  maxNode <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  polyModel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GPCM"</span>, <span class="st">"GRM"</span><span class="op">)</span>,</span>
<span>  weightVar <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  multiCore <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  bobyqaControl <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  composite <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  strataVar <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  PSUVar <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fast <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  calcCor <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  retainedInformation <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  optimizer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"EM"</span>, <span class="st">"QN"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>a <code><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></code>
object in the style of <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></code></p></dd>


<dt id="arg-stuitems">stuItems<a class="anchor" aria-label="anchor" href="#arg-stuitems"></a></dt>
<dd><p>deprecated. Simply put items in <code>stuDat</code> now.</p></dd>


<dt id="arg-studat">stuDat<a class="anchor" aria-label="anchor" href="#arg-studat"></a></dt>
<dd><p>a <code>data.frame</code> with a single row per student. Predictors in
the <code>formula</code> must be in <code>stuDat</code> as well as items.</p></dd>


<dt id="arg-idvar">idVar<a class="anchor" aria-label="anchor" href="#arg-idvar"></a></dt>
<dd><p>a variable name on <code>stuDat</code> that is the identifier. Every
ID from <code>stuDat</code> must appear on <code>stuItems</code> and vice versa.</p></dd>


<dt id="arg-dichotparamtab">dichotParamTab<a class="anchor" aria-label="anchor" href="#arg-dichotparamtab"></a></dt>
<dd><p>a <code>data.frame</code> of dichotomous item information, see Details</p></dd>


<dt id="arg-polyparamtab">polyParamTab<a class="anchor" aria-label="anchor" href="#arg-polyparamtab"></a></dt>
<dd><p>a <code>data.frame</code> of polytomous item information, see Details</p></dd>


<dt id="arg-testscale">testScale<a class="anchor" aria-label="anchor" href="#arg-testscale"></a></dt>
<dd><p>a <code>data.frame</code> of scaling information, see Details</p></dd>


<dt id="arg-q">Q<a class="anchor" aria-label="anchor" href="#arg-q"></a></dt>
<dd><p>an integer; the number of integration points</p></dd>


<dt id="arg-minnode">minNode<a class="anchor" aria-label="anchor" href="#arg-minnode"></a></dt>
<dd><p>a numeric; the smallest integration point for the latent variable</p></dd>


<dt id="arg-maxnode">maxNode<a class="anchor" aria-label="anchor" href="#arg-maxnode"></a></dt>
<dd><p>a numeric; the largest integration point for the latent variable</p></dd>


<dt id="arg-polymodel">polyModel<a class="anchor" aria-label="anchor" href="#arg-polymodel"></a></dt>
<dd><p>polytomous response model;
one of <code>GPCM</code> for the Graded Partial Credit Model
or <code>GRM</code> for the Graded Response Model</p></dd>


<dt id="arg-weightvar">weightVar<a class="anchor" aria-label="anchor" href="#arg-weightvar"></a></dt>
<dd><p>a variable name on <code>stuDat</code> that is the full sample weight</p></dd>


<dt id="arg-multicore">multiCore<a class="anchor" aria-label="anchor" href="#arg-multicore"></a></dt>
<dd><p>a logical indicating whether to use parallel processing</p></dd>


<dt id="arg-bobyqacontrol">bobyqaControl<a class="anchor" aria-label="anchor" href="#arg-bobyqacontrol"></a></dt>
<dd><p>deprecated. A list that gets passed to the <code>bobyqa</code> optimizer in <code>minqa</code></p></dd>


<dt id="arg-composite">composite<a class="anchor" aria-label="anchor" href="#arg-composite"></a></dt>
<dd><p>a logical indicating if an overall test should be treated as
a composite score; a composite is a weighted average of the
subscales in it.</p></dd>


<dt id="arg-stratavar">strataVar<a class="anchor" aria-label="anchor" href="#arg-stratavar"></a></dt>
<dd><p>character naming a variable on <code>stuDat</code>, the variable indicating the
stratum for each row. Used in post-hoc robust variance estimation.</p></dd>


<dt id="arg-psuvar">PSUVar<a class="anchor" aria-label="anchor" href="#arg-psuvar"></a></dt>
<dd><p>character naming a variable on <code>stuDat</code>; the primary sampling unit
(PSU) variable. Used in post-hoc robust variance estimation. The values
do not need to be unique across strata.</p></dd>


<dt id="arg-fast">fast<a class="anchor" aria-label="anchor" href="#arg-fast"></a></dt>
<dd><p>deprecated. Always TRUE now.</p></dd>


<dt id="arg-calccor">calcCor<a class="anchor" aria-label="anchor" href="#arg-calccor"></a></dt>
<dd><p>deprecated. Always TRUE now.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>integer, negative or zero for no details, increasingly verbose messages at one and two</p></dd>


<dt id="arg-retainedinformation">retainedInformation<a class="anchor" aria-label="anchor" href="#arg-retainedinformation"></a></dt>
<dd><p>set to a value of 1 to fit the model as is typically fit. If the value is less than one, a principal component analysis is performed and columns associated with principal components totaling at least <code>retainedInformation</code> are retained while all other data is discarded. The estimated latent regression coefficients will accordingly be named as PC1, ..., PCN.</p></dd>


<dt id="arg-optimizer">optimizer<a class="anchor" aria-label="anchor" href="#arg-optimizer"></a></dt>
<dd><p>character naming the optimization method to use;
one of <code>EM</code> for Expectation Maximization
or <code>QN</code> for Quasi-Newton</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>When called for a single subscale or overall score, returns object of class <code>mmlMeans</code>.
This is a list with elements:</p><ul><li><p><code>call</code> the call used to generate this <code>mml.means</code> object</p></li>
<li><p><code>coefficients</code> the unscaled marginal maximum likelihood regression coefficients</p></li>
<li><p><code>LogLik</code> the log-likelihood of the fit model</p></li>
<li><p><code>getX</code> a function that, when called on <code>stuDat</code>, returns the design matrix of the marginal maximum likelihood regression</p></li>
<li><p><code>Convergence</code> a convergence note from the optimizer</p></li>
<li><p><code>location</code> used for scaling the estimates</p></li>
<li><p><code>scale</code> used for scaling the estimates</p></li>
<li><p><code>lnlf</code> the log-likelihood function of the unscaled parameters</p></li>
<li><p><code>funcs</code> a list of functions that may be evaluated on a vector of parameters. The first returns the log-likelihood of the marginal maximum likelihood regression evaluated at the given parameters. The second and third correspond to the first and second derivatives, respectively, of the MML regression evaluated at the parameters.</p></li>
<li><p><code>rr1</code> the density function of each individual, conditional only on item responses in <code>stuItems</code></p></li>
<li><p><code>stuDat</code> the <code>stuDat</code> argument</p></li>
<li><p><code>likelihood_stus</code> <code>rr1</code>, but pivoted long so that each row corresponds to a student.</p></li>
<li><p><code>weightVar</code> the name of the weight variable on <code>stuDat</code></p></li>
<li><p><code>nodes</code> the nodes the likelihood was evaluated on</p></li>
<li><p><code>iterations</code> the number of iterations required to reach convergence</p></li>
<li><p><code>obs</code> the number of observations used</p></li>
<li><p><code>testScale</code> the <code>testScale</code> used to scale the data</p></li>
<li><p><code>weightedObs</code> the weighted N for the observations</p></li>
<li><p><code>strataVar</code> the column name of the stratum variable on stuDat; potentially used for variance estimation</p></li>
<li><p><code>PSUVar</code> the column name of the PSU variable on stuDat; potentially used for variance estimation</p></li>
<li><p><code>itemScorePoints</code> a data frame that shows item IDs, the number of score points, expected scores (both from the paramTab arguments), as well as the occupied score points</p></li>
<li><p><code>formula</code> the formula passed to <code>mml</code></p></li>
<li><p><code>contrasts</code> the contrasts used in forming the design matrix</p></li>
<li><p><code>xlevels</code> the levels of the covariates used in forming the design matrix</p></li>
<li><p><code>polyModel</code> the value of the argument of the same name passed to <code>mml</code></p></li>
<li><p><code>paramTab</code> a data frame that condenses <code>dichotParamTab</code> and <code>polyParamTab</code></p></li>
<li><p><code>fast</code> the value of the argument of the same name passed to <code>mml</code></p></li>
<li><p><code>idVar</code> the value of the argument of the same name passed to <code>mml</code></p></li>
<li><p><code>posteriorEsts</code> the posterior estimates for the people in <code>stuDat</code> included in the model</p></li>
<li><p><code>pred</code> the predicted outcome based on the estimated coefficients</p></li>
<li><p><code>values</code> a list of values used for posterior estimation</p></li>
<li><p><code>V</code> a diagonal matrix of the number of columns in the design matrix</p></li>
</ul><p>When a composite score is computed there are several subscales run and the return is a <code>mmlCompositeMeans</code>. Many elements are themselves list with one element per construct.
this is a list with elements:</p><ul><li><p><code>call</code> the call used to generate this <code>mml.means</code> object</p></li>
<li><p><code>coefficients</code> matrix of the unscaled marginal maximum likelihood regression coefficients, each row represents a subscale, each column represents a coefficient</p></li>
<li><p><code>X</code> the design matrix of the marginal maximum likelihood regression</p></li>
<li><p><code>rr1</code> a list of elements, each the rr1 object for a subscale (see <code>mmlMeans</code> output)</p></li>
<li><p><code>ids</code> The ID variable used for each row of <code>stuDat</code></p></li>
<li><p><code>Convergence</code> a vector of convergence notes from the optimizer</p></li>
<li><p><code>lnlfl</code> a list of log-likelihood functions of the unscaled parameters, by construct</p></li>
<li><p><code>stuDat</code> a list of <code>stuDat</code> data frames, as used when fitting each construct, filtered to just relevant student records</p></li>
<li><p><code>weightVar</code> the name of the weight variable on <code>stuDat</code></p></li>
<li><p><code>nodes</code> the nodes the likelihood was evaluated on</p></li>
<li><p><code>iterations</code> a vector of the number of iterations required to reach convergence on each construct</p></li>
<li><p><code>obs</code> a vector of the the number of observations used on each construct</p></li>
<li><p><code>testScale</code> the <code>testScale</code> used to scale the data</p></li>
<li><p><code>weightedObs</code> a vector of the weighted N for the observations</p></li>
<li><p><code>SubscaleVC</code> the covariance matrix of subscales. The residuals are assumed to be multivariate normal with this covariance matrix</p></li>
<li><p><code>idVar</code> the name of the identifier used on <code>stuDat</code> and <code>stuItems</code> data</p></li>
<li><p><code>resl</code> list of mmlMeans objects, one per construct</p></li>
<li><p><code>strataVar</code> the column name of the stratum variable on <code>stuDat</code>; potentially used for variance estimation</p></li>
<li><p><code>PSUVar</code> the column name of the PSU variable on <code>stuDat</code>; potentially used for variance estimation</p></li>
<li><p><code>stuItems</code> the data frame passed to <code>mml</code> reformatted for use in mml</p></li>
<li><p><code>formula</code> the formula passed to <code>mml</code></p></li>
<li><p><code>contrasts</code> the contrasts used in forming the design matrix</p></li>
<li><p><code>xlevels</code> the levels of the covariates used in forming the design matrix</p></li>
<li><p><code>polyModel</code> the value of the argument of the same name passed to <code>mml</code></p></li>
<li><p><code>posteriorEsts</code> the list of posterior estimates for the people in <code>stuDat</code> included in the model</p></li>
<li><p><code>SubscaleVC</code> the matrix of latent correlations across constructs</p></li>
<li><p><code>modelFrameFull</code> the full model frame</p></li>
<li><p><code>stuDatSubsets</code> a logical matrix with a column per subscale and a row for each student; used for subsetting students within subscales</p></li>
<li><p><code>values</code> a list of values used for posterior estimation</p></li>
</ul><p><code>LogLik</code> is not returned because there is no likelihood for a composite model.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The <code>mml</code> function models a latent outcome conditioning on
item response data, covariate data, item parameter information,
and scaling information.
These four parts are broken up into at least one argument each.
Student item response data go into <code>stuItems</code>; whereas student
covariates, weights, and sampling information go into <code>stuDat</code>.
The <code>dichotParamTab</code> and <code>polyParamTab</code>
contain item parameter information for dichotomous and polytomous items,
respectively—the item parameter data is the result of an existing
item parameter scaling. In the case of
the National Assessment of Educational Progress (NAEP),
they can be found online, for example, at
<a href="https://nces.ed.gov/nationsreportcard/tdw/analysis/scaling_irt.aspx" class="external-link">NAEP technical documentation</a>.
Finally, information about scaling and subscale weights for composites are put in <code>testScale</code>.</p>
<p>The model for dichotomous responses data is, by default, three Parameter Logit
(3PL), unless the item parameter information provided by users suggests
otherwise. For example, if the scaling used a two Parameter Logit (2PL) model,
then the guessing parameter can simply be set to zero. For polytomous
responses data, the model is dictated by the <code>polyModel</code> argument.</p>
<p>The <code>dichotParamTab</code> argument is a <code>data.frame</code> with a column named
<code>ItemID</code> that identifies the items and agrees with
the <code>key</code> column in the <code>stuItems</code> argument,
and, for  a 3PL item, columns <code>slope</code>,
<code>difficulty</code>, and <code>guessing</code> for the “a”, “d”, and
“g” parameters, respectively; see the vignette for details of
the 3PL model. Users can also use the column names directly from the
vignette notation (“a”, “d”, and “g”) if they prefer.
Items that are missing (<code>NA</code>) are not used in the likelihood function.
Users wishing to apply a special behavior for a subset of items can use
set those items to an invalid score and put that in the <code>dichotParamTab</code>
column <code>missingCode</code>. They are then scored as if they are <code>missingValue</code>
proportion correct. To use the guessing parameter for the proportion correct
set <code>missingValue</code> to “c”.</p>
<p>The <code>polyParamTab</code> has columns <code>ItemID</code> that must match with the
<code>key</code> from <code>stuItems</code>, as well as <code>slope</code>
(which can also be called <code>a</code>) that corresponds to the <code>a</code>
parameter in the vignette.
Users must also specify the location of the cut points (\(d_{cj}\) in the vignette)
which are named <code>d1</code>, <code>d2</code>, ..., up to <code>dn</code> where <code>n</code> is
one less than the number of score points. Some people prefer to also apply a
shift to all of these and this shift is applied when there is a column named
<code>itemLocation</code> by simply adding that to every <code>d*</code> column. Items
are not included in the likelihood for an individual when their value on <code>stuItems</code>
is <code>NA</code>, but no provision is made for guessing, nor special provision for
missing codes in polytomous items.</p>
<p>For both <code>dichotParamTab</code> and <code>polyParamTab</code> users wishing
to use a <code>D</code> paramter of 1.7 (or any other value) may specify that, per item,
in a column named <code>D</code>.</p>
<p>When there are multiple constructs, subscales, or the user wants a composite
score, additional, optional, columns <code>test</code> and <code>subtest</code> can be used.
these columns can be numeric or text, they must agree with the same
columns in <code>testScale</code> to scale the results.</p>
<p>Student data are broken up into two parts. The item response data goes
into <code>stuItems</code>, and the student covariates for the formula go into
<code>stuDat</code>. Information about items, such as item difficulties, is in
<code>paramTab</code>. All dichotomous items are assumed to be
3PL, though by setting the guessing parameter to zero, the user
can use a 2PL or the one Parameter Logit (1PL) or Rasch models.
The model for polytomous responses data is dictated by the <code>polyModel</code>
argument.</p>
<p>The marginal maximum likelihood then integrates the product of the student
ability from the assessment data, and the estimate from the linear model
estimates each student's ability based on the <code>formula</code> provided
and a residual standard error term. This integration happens from the
minimum node to the maximum node in the <code>control</code> argument (described
later in this section) with <code>Q</code> quadrature points.</p>
<p>The <code>stuItems</code> argument has the scored student data. It is a list where
each element is named with student ID and contains
a <code>data.frame</code> with at least two columns.
The first required column is named
<code>key</code> and shows the item name as it appears in <code>paramTab</code>;
the second column in named
<code>score</code> and shows the score for that item. For dichotomous
items, the <code>score</code> is 0 or 1. For <code>GPCM</code> items, the scores
start at zero as well. For <code>GRM</code>, the scores start at 1.</p>
<p>For a <code>GPCM</code> model, <code>P0</code> is the “a” parameter, and the other
columns are the “d” parameters; see the vignette for details
of the GPCM model.</p>
<p>The quadrature points then are a range from <code>minNode</code> to <code>maxNode</code>
with a total of <code>Q</code> nodes.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Harold Doran, Paul Bailey, Claire Kelley, Sun-joo Lee, and Eric Buehler</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://www.air.org/project/nces-data-r-project-edsurvey" class="external-link">EdSurvey</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 1) make param tab for dichotomous items</span></span></span>
<span class="r-in"><span><span class="va">dichotParamTab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>ItemID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m109801"</span>, <span class="st">"m020001"</span>, <span class="st">"m111001"</span>,</span></span>
<span class="r-in"><span>                                        <span class="st">"m046301"</span>, <span class="st">"m046501"</span>, <span class="st">"m051501"</span>,</span></span>
<span class="r-in"><span>                                        <span class="st">"m111601"</span>, <span class="st">"m111301"</span>, <span class="st">"m111201"</span>,</span></span>
<span class="r-in"><span>                                        <span class="st">"m110801"</span>, <span class="st">"m110101"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                             test <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"composite"</span>,<span class="fl">11</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                             subtest <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"num"</span>,<span class="fl">6</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"alg"</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                             slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.96</span>, <span class="fl">0.69</span>, <span class="fl">0.83</span>,</span></span>
<span class="r-in"><span>                                       <span class="fl">0.99</span>, <span class="fl">1.03</span>, <span class="fl">0.97</span>,</span></span>
<span class="r-in"><span>                                       <span class="fl">1.45</span>, <span class="fl">0.59</span>, <span class="fl">0.34</span>,</span></span>
<span class="r-in"><span>                                       <span class="fl">0.18</span>, <span class="fl">1.20</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                             difficulty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.37</span>, <span class="op">-</span><span class="fl">0.55</span>,  <span class="fl">0.85</span>,</span></span>
<span class="r-in"><span>                                            <span class="op">-</span><span class="fl">0.97</span>, <span class="op">-</span><span class="fl">0.14</span>,  <span class="fl">1.21</span>,</span></span>
<span class="r-in"><span>                                             <span class="fl">0.53</span>, <span class="op">-</span><span class="fl">1.84</span>, <span class="op">-</span><span class="fl">0.46</span>,</span></span>
<span class="r-in"><span>                                             <span class="fl">2.43</span>,  <span class="fl">0.70</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                             guessing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.16</span>, <span class="fl">0.00</span>, <span class="fl">0.17</span>,</span></span>
<span class="r-in"><span>                                          <span class="fl">0.31</span>, <span class="fl">0.37</span>, <span class="fl">0.18</span>,</span></span>
<span class="r-in"><span>                                          <span class="fl">0.28</span>, <span class="fl">0.15</span>, <span class="fl">0.09</span>,</span></span>
<span class="r-in"><span>                                          <span class="fl">0.05</span>, <span class="fl">0.18</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                             D <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1.7</span>, <span class="fl">11</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                             MODEL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"3pl"</span>, <span class="fl">11</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># param tab for GPCM items</span></span></span>
<span class="r-in"><span><span class="va">polyParamTab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>ItemID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m0757cl"</span>, <span class="st">"m066501"</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           test <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"composite"</span>,<span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           subtest <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"alg"</span>,<span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.43</span>, <span class="fl">0.52</span><span class="op">)</span>, <span class="co"># could also be called "a"</span></span></span>
<span class="r-in"><span>                           itemLocation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.21</span>, <span class="op">-</span><span class="fl">0.96</span><span class="op">)</span>, <span class="co"># added to d1 ... dn</span></span></span>
<span class="r-in"><span>                           d1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.38</span>, <span class="op">-</span><span class="fl">0.56</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                           d2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.57</span>, <span class="fl">0.56</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           d3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.18</span>, <span class="cn">NA</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           D <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.7</span>, <span class="fl">1.7</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           scorePoints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3L</span>, <span class="fl">2L</span><span class="op">)</span><span class="op">)</span> <span class="co"># number of score points, read d1 to d(n-1)</span></span></span>
<span class="r-in"><span><span class="co"># read-in NAEP Primer data </span></span></span>
<span class="r-in"><span><span class="va">sdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/EdSurvey/man/readNAEP.html" class="external-link">readNAEP</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/data"</span>, <span class="st">"M36NT2PM.dat"</span>, package <span class="op">=</span> <span class="st">"NAEPprimer"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># read in these items</span></span></span>
<span class="r-in"><span><span class="va">items</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">dichotParamTab</span><span class="op">$</span><span class="va">ItemID</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">polyParamTab</span><span class="op">$</span><span class="va">ItemID</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># dsex, student sex</span></span></span>
<span class="r-in"><span><span class="co"># origwt, full sample weights</span></span></span>
<span class="r-in"><span><span class="co"># repgrp1, stratum indicator</span></span></span>
<span class="r-in"><span><span class="co"># jkunit, PSU indicator</span></span></span>
<span class="r-in"><span><span class="va">edf</span> <span class="op">&lt;-</span> <span class="fu">EdSurvey</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/EdSurvey/man/getData.html" class="external-link">getData</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">sdf</span>,</span></span>
<span class="r-in"><span>                         varnames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">items</span>, <span class="st">"dsex"</span>, <span class="st">"origwt"</span>, <span class="st">"repgrp1"</span>, <span class="st">"jkunit"</span>, <span class="st">"sdracem"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                         dropOmittedLevels <span class="op">=</span> <span class="cn">FALSE</span>, returnJKreplicates<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># make up a student ID</span></span></span>
<span class="r-in"><span><span class="va">edf</span><span class="op">$</span><span class="va">sid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"S"</span>,<span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">edf</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># apply simplified scoring</span></span></span>
<span class="r-in"><span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">items</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">coli</span> <span class="op">&lt;-</span> <span class="va">items</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="co"># save the original</span></span></span>
<span class="r-in"><span>  <span class="va">rawcol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">coli</span>,<span class="st">"raw"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">edf</span><span class="op">[</span>,<span class="va">rawcol</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">edf</span><span class="op">[</span>,<span class="va">coli</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span><span class="op">(</span> <span class="va">coli</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">dichotParamTab</span><span class="op">$</span><span class="va">ItemID</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">edf</span><span class="op">[</span>,<span class="va">coli</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"[ABCDE]"</span>, <span class="va">edf</span><span class="op">[</span>,<span class="va">rawcol</span><span class="op">]</span><span class="op">)</span>, <span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">edf</span><span class="op">[</span>,<span class="va">coli</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Incorrect"</span>, <span class="va">edf</span><span class="op">[</span>,<span class="va">rawcol</span><span class="op">]</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">edf</span><span class="op">[</span>,<span class="va">coli</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">edf</span><span class="op">[</span>,<span class="va">coli</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"[*]"</span>, <span class="va">edf</span><span class="op">[</span>,<span class="va">rawcol</span><span class="op">]</span><span class="op">)</span>, <span class="fl">1</span>, <span class="va">edf</span><span class="op">[</span>,<span class="va">coli</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="co"># scale for m066501</span></span></span>
<span class="r-in"><span>    <span class="va">edf</span><span class="op">[</span>,<span class="va">coli</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Incorrect"</span>, <span class="va">edf</span><span class="op">[</span>,<span class="va">rawcol</span><span class="op">]</span><span class="op">)</span>, <span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">edf</span><span class="op">[</span>,<span class="va">coli</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Partial"</span>, <span class="va">edf</span><span class="op">[</span>,<span class="va">rawcol</span><span class="op">]</span><span class="op">)</span>, <span class="fl">1</span>, <span class="va">edf</span><span class="op">[</span>,<span class="va">coli</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">edf</span><span class="op">[</span>,<span class="va">coli</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Correct"</span>, <span class="va">edf</span><span class="op">[</span>,<span class="va">rawcol</span><span class="op">]</span><span class="op">)</span>, <span class="fl">2</span>, <span class="va">edf</span><span class="op">[</span>,<span class="va">coli</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co"># scale for m0757cl</span></span></span>
<span class="r-in"><span>    <span class="va">edf</span><span class="op">[</span>,<span class="va">coli</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"None correct"</span>, <span class="va">edf</span><span class="op">[</span>,<span class="va">rawcol</span><span class="op">]</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">edf</span><span class="op">[</span>,<span class="va">coli</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">edf</span><span class="op">[</span>,<span class="va">coli</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"One correct"</span>, <span class="va">edf</span><span class="op">[</span>,<span class="va">rawcol</span><span class="op">]</span><span class="op">)</span>, <span class="fl">1</span>, <span class="va">edf</span><span class="op">[</span>,<span class="va">coli</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">edf</span><span class="op">[</span>,<span class="va">coli</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Two correct"</span>, <span class="va">edf</span><span class="op">[</span>,<span class="va">rawcol</span><span class="op">]</span><span class="op">)</span>, <span class="fl">2</span>, <span class="va">edf</span><span class="op">[</span>,<span class="va">coli</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">edf</span><span class="op">[</span>,<span class="va">coli</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Three correct"</span>, <span class="va">edf</span><span class="op">[</span>,<span class="va">rawcol</span><span class="op">]</span><span class="op">)</span>, <span class="fl">3</span>, <span class="va">edf</span><span class="op">[</span>,<span class="va">coli</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="va">edf</span><span class="op">[</span>,<span class="va">rawcol</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span> <span class="co"># delete original</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># end scoreing</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># stuDat is one row per student an contains student-level information</span></span></span>
<span class="r-in"><span><span class="va">stuDat</span> <span class="op">&lt;-</span> <span class="va">edf</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sid"</span>, <span class="st">"origwt"</span>, <span class="st">"repgrp1"</span>, <span class="st">"jkunit"</span>, <span class="st">"dsex"</span>, <span class="st">"sdracem"</span>, <span class="va">items</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># testDat shows scaling and weights for subtests, an overall score can be treated as a subtest</span></span></span>
<span class="r-in"><span><span class="va">testDat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>test<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"composite"</span>, <span class="st">"composite"</span><span class="op">)</span> ,</span></span>
<span class="r-in"><span>                      subtest<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"num"</span>, <span class="st">"alg"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                      location<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">277.1563</span>, <span class="fl">280.2948</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                      scale<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">37.7297</span>, <span class="fl">36.3887</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                      subtestWeight<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>,<span class="fl">0.7</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># estimate a regression for Algebra subscale</span></span></span>
<span class="r-in"><span><span class="va">mmlA</span> <span class="op">&lt;-</span> <span class="fu">mml</span><span class="op">(</span><span class="va">alg</span> <span class="op">~</span> <span class="va">dsex</span>,</span></span>
<span class="r-in"><span>            stuDat<span class="op">=</span><span class="va">stuDat</span>,</span></span>
<span class="r-in"><span>            dichotParamTab<span class="op">=</span><span class="va">dichotParamTab</span>, polyParamTab<span class="op">=</span><span class="va">polyParamTab</span>,</span></span>
<span class="r-in"><span>            testScale<span class="op">=</span><span class="va">testDat</span>,</span></span>
<span class="r-in"><span>            idVar<span class="op">=</span><span class="st">"sid"</span>, weightVar<span class="op">=</span><span class="st">"origwt"</span>, <span class="co"># these are column names on stuDat</span></span></span>
<span class="r-in"><span>            strataVar<span class="op">=</span><span class="st">"repgrp1"</span>, PSUVar<span class="op">=</span><span class="st">"jkunit"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># summary, with Taylor standard errors</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mmlA</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># estimate a regression for Numeracy subscale</span></span></span>
<span class="r-in"><span><span class="va">mmlN</span> <span class="op">&lt;-</span> <span class="fu">mml</span><span class="op">(</span><span class="va">num</span> <span class="op">~</span> <span class="va">dsex</span>,</span></span>
<span class="r-in"><span>            stuDat<span class="op">=</span><span class="va">stuDat</span>,</span></span>
<span class="r-in"><span>            dichotParamTab<span class="op">=</span><span class="va">dichotParamTab</span>, polyParamTab<span class="op">=</span><span class="va">polyParamTab</span>,</span></span>
<span class="r-in"><span>            testScale<span class="op">=</span><span class="va">testDat</span>,</span></span>
<span class="r-in"><span>            Q<span class="op">=</span><span class="fl">128</span>,</span></span>
<span class="r-in"><span>            idVar<span class="op">=</span><span class="st">"sid"</span>, weightVar<span class="op">=</span><span class="st">"origwt"</span>, <span class="co"># these are column names on stuDat</span></span></span>
<span class="r-in"><span>            strataVar<span class="op">=</span><span class="st">"repgrp1"</span>, PSUVar<span class="op">=</span><span class="st">"jkunit"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># summary, with Taylor standard errors</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mmlN</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># draw plausible values for mmlA</span></span></span>
<span class="r-in"><span><span class="va">pvd</span> <span class="op">&lt;-</span> <span class="fu"><a href="drawPVs.html">drawPVs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mmlA</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pvd</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># composite regression </span></span></span>
<span class="r-in"><span><span class="va">mmlC</span> <span class="op">&lt;-</span> <span class="fu">mml</span><span class="op">(</span><span class="va">composite</span> <span class="op">~</span> <span class="va">dsex</span> ,</span></span>
<span class="r-in"><span>            stuDat<span class="op">=</span><span class="va">stuDat</span>,</span></span>
<span class="r-in"><span>            dichotParamTab<span class="op">=</span><span class="va">dichotParamTab</span>, polyParamTab<span class="op">=</span><span class="va">polyParamTab</span>,</span></span>
<span class="r-in"><span>            testScale<span class="op">=</span><span class="va">testDat</span>,</span></span>
<span class="r-in"><span>            idVar<span class="op">=</span><span class="st">"sid"</span>, weightVar<span class="op">=</span><span class="st">"origwt"</span>, <span class="co"># these are column names on stuDat</span></span></span>
<span class="r-in"><span>            strataVar<span class="op">=</span><span class="st">"repgrp1"</span>, PSUVar<span class="op">=</span><span class="st">"jkunit"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># summary, with Taylor standard errors</span></span></span>
<span class="r-in"><span><span class="va">mmlCsum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mmlC</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mmlCsum</span> <span class="co"># show results</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># draw plausible values for mmlC, show first few rows</span></span></span>
<span class="r-in"><span><span class="va">pvc</span> <span class="op">&lt;-</span> <span class="fu"><a href="drawPVs.html">drawPVs</a></span><span class="op">(</span><span class="va">mmlCsum</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pvc</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Paul Bailey, Eric Buehler, Sun-joo Lee, Harold Doran, Blue Webb.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

